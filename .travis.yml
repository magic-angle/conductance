language: node_js
node_js:
  - "0.10"
env:
  - a="test/run --karma single-run"
  - a="test/run --karma single-run" BROWSERS=Firefox
  - a="test/run"
  - a="tools/seed/test/ci"

# workaround https://github.com/npm/npm/issues/6679
install: "npm install --production && ./tools/gup node_modules/update"

matrix:
  # just run integration tests on other node versions
  include:
    - node_js: "0.11"
      env: a="test/run"
  allow_failures:
    - node_js: "0.11"
      env: a="test/run"
    - node_js: "0.10"
      env: a="tools/seed/test/ci"
  
notifications:
  email:
    recipients:
      - commits@onilabs.com
    on_success: change
    on_failure: always
  hipchat:
    rooms:
      secure: WuyQPqKVxrDykbFkXVRZcPQNa0dmmTzpb+xEzBqCwOhyCeTQTAon1HIUEQtmwPJmTwBZX7dTGwa5kOnbCN47quVaOMkkJVsXQFzlDVv9aWz8XH5Hoj50odHFcTJvhjLKoL9wwG6B2z3PTDuP9PyifQBnIUwW3ihaXFmNGDj5ri0=
    template:
      - '%{repository_name}#%{commit} (%{author}): %{message} [%{build_url}]'
    on_success: change
    on_failure: always

branches:
  # build only master and release braches
  only:
    - master
    - /^\d+(\.\d+)+$/

script: "node --expose-gc ./conductance exec $a --show-failed"

